graph TD
    subgraph "genui Package"
        GenUiConversation["GenUiConversation (Facade)"]
        GenUiTransport["GenUiTransport (Interface)"]
        A2uiTransportAdapter["A2uiTransportAdapter"]
        GenUiController["GenUiController (Engine)"]
        Transformer["A2uiParserTransformer"]
        Catalog["Widget Catalog"]
        DataModel["DataModel"]
        GenUiSurface["GenUiSurface (Widget)"]
    end


    AppLogic -- "Initializes" --> GenUiConversation
    GenUiConversation -- "Uses" --> GenUiTransport
    GenUiConversation -- "Manages" --> GenUiController

    AppLogic -- "Sends User Input" --> GenUiConversation
    GenUiConversation -- "Delegates to" --> GenUiTransport
    GenUiTransport -- "Calls callback" --> ExternalLLM
    ExternalLLM -- "Returns chunks" --> A2uiTransportAdapter
    A2uiTransportAdapter -- "Pipes to" --> Transformer
    Transformer -- "Parses into<br>messages" --> A2uiTransportAdapter
    A2uiTransportAdapter -- "Stream<A2uiMessage>" --> GenUiTransport
    GenUiTransport -- "Pipes to" --> GenUiConversation
    GenUiConversation -- "Dispatches to" --> GenUiController

    GenUiController -- "Owns" --> DataModel
    GenUiController -- "Notifies of updates" --> GenUiConversation
    GenUiController -- "Notifies of updates" --> GenUiSurface

    UserUI -- "Instantiates" --> GenUiSurface
    GenUiSurface -- "Builds widgets using" --> Catalog
    GenUiSurface -- "Reads/writes state via" --> DataModel
    GenUiSurface -- "Sends UI events" --> GenUiController

    GenUiController -- "Client events (onSubmit)" --> GenUiConversation
    GenUiConversation -- "Loops back" --> GenUiTransport